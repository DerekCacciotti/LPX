<!DOCTYPE html>
<html lang="en">
<head>
    <title>LPX- Order Status</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://www.parsecdn.com/js/parse-1.6.14.min.js"></script>

</head>
<body>


  <nav class=" navbar navbar-inverse">
    <div class="container-fluid">
      <!-- logo -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collaspe" data-target="#mainnavbar">
          <!-- make the three line icon found on chrome in the menu bar for settings-->
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="#" class="navbar-brand">LPX</a>
      </div>

      <!-- MENU ITEMS-->
      <div class="collaspe navbar-collaspe" id="mainnavbar">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>


        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
                   <a href="#" class="dropdown-toggle" data-toggle="dropdown">My Profile <span class="caret"></span></a>
                   <ul class="dropdown-menu">
                       <li><a href="dashboard.html">Dashboard</a></li>
                       <li class="active"><a href="search.html">Database</a></li>
                       <li><a href="#">Log Out</a></li>
                   </ul>
               </li>
           </ul>

            </ul>

      </div>
    </div>

  </nav>


  <div class="container" id="lookupbox">
      <div class="row">
          <div class="col-sm-6 col-md-4 col-md-offset-4">

              <div class="account-wall">
                    <h1 class="text-center login-title">Please enter your Order Number.</h1>
                  <form class="form-signin">
                  <input type="text" class="form-control" placeholder="Order Number" id="ordernumber" required autofocus>
                  <br />
                  <input type="button" class="btn btn-lg btn-primary btn-block"  name="loopup" value="Look Up" onclick="Lookup()">

                  </form>
              </div>

          </div>
      </div>
  </div>

  <div class="container" id="ordersection">



        <table id="order-table" class="table">

      <tr>
        <th>Item and Amount</th>
        <th>Returned Pricing</th>
        <th>Seller</th>












      </tr>





      </table>

      <p id="submittedbylabel"></p>
      <p id="totallabel" class="pull-right"></p>














</div>

<div class="center" id="comp">
<h1 id="compdir"></h1>





</div>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title" id="modalheader"></h4>
      </div>
      <div class="modal-body" id="modalbody">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal" id="modalclose">Close</button>
      </div>
    </div>

  </div>
</div>




  <script type="text/javascript">

    Parse.initialize("bmobCoB17mgSf7S9J6ZntiQGq5NEm2eIyHroyP9t", "Wut80Nd7rKFVvHEvT7K9jQMCV2HIO67OEH0pWaBe");
      Parse.serverURL = 'https://rayfoodapp.herokuapp.com/parse'

      document.onload = hideTable();

      var globordernum;

      var pricearray = [];
      var sellersarray = [];

    var currentUser = Parse.User.current();
    var total = 0



// function to hide the div with the table
function hideTable()
{
  $("#ordersection").toggle();



}


function Lookup()
{
  var ordernumber = document.getElementById("ordernumber").value
  console.log(ordernumber)
  globordernum = ordernumber

  var furfilledorders = Parse.Object.extend("furfilledorders");
var query = new Parse.Query(furfilledorders);
query.equalTo("ordernumber", ordernumber);
query.equalTo("orderfor", currentUser.get("username"))
query.find({
  success: function(results) {
    console.log(results.length)
    HideLookupBox();



    for(var i = 0; i < results.length; i++)
    {
      var orderdeailts = results[i];

      var savedorder = orderdeailts.get("furfilledorder")
      console.log(savedorder.orderdetails)
      for (details in savedorder.orderdetails)
      {
          console.log(savedorder.orderdetails[details])

          pricearray.push(savedorder.prices)



          $('#order-table').append('<tr><td id="item">' + savedorder.orderdetails[details] + '</td><td>' + 	savedorder.prices[details] +'</td><td>' + orderdeailts.get("seller") + '</td></tr>')

      }









    }

    CreateButtons(globordernum)

  },
  error: function(error) {
    alert("Error finding your order");
  }
});
}

function HideLookupBox()
{
  $("#lookupbox").toggle();
  $("#ordersection").toggle();



}


function CreateButtons(ordernumber)
{
$("comp").toggle();
  var furfilledorder = Parse.Object.extend("furfilledorders");
  var query = new Parse.Query(furfilledorder);
  query.equalTo("ordernumber", ordernumber);
  query.find({
    success: function(results) {
      console.log("Successfully retrieved " + results.length);
      // Do something with the returned Parse.Object values
      for (var i = 0; i < results.length; i++) {
        var object = results[i];
      sellersarray.push(object.get("seller"))
      }
      console.log(sellersarray)

      var directions = document.getElementById("compdir")
      directions.innerHTML = "Please click the name of the seller to determine if they are a good fit for your business"

      var buttondiv = document.getElementById("comp")

  for(var i = 0; i < sellersarray.length; i++)
{
  var buttonelement = document.createElement("input")
  buttonelement.type = "button"
  buttonelement.className = "btn btn-default"
  buttonelement.value = sellersarray[i]
  buttonelement.name = "sellerbutton"
  buttondiv.appendChild(buttonelement)
}

$("input[name=sellerbutton]").click(function() {
console.log($(this).val())
var selectedseller = $(this).val()
$("#myModal").modal()
PopulateModal(selectedseller)
});


    },
    error: function(error) {
      alert("Error: " + error.code + " " + error.message);
    }
  });
}


function PopulateModal(selectedseller)
{
  var furfilledorder = Parse.Object.extend("furfilledorders");
var query = new Parse.Query(furfilledorder);
query.equalTo("seller", selectedseller);
query.find({
  success: function(results) {
    console.log("Successfully retrieved " + results.length);
    // Do something with the returned Parse.Object values
    for (var i = 0; i < results.length; i++) {
      var object = results[i];
      console.log(object.get("furfilledorder").prices)
      var selectedprices = object.get("furfilledorder").prices

    }
    console.log(selectedprices)

    // modal header
    var modalheader = document.getElementById("modalheader")
    modalheader.innerHTML = "Order by " + selectedseller


    // body of the modal
    var modalbody = document.getElementById("modalbody")
    var p = document.createElement("p")
    p.id = "total"

    for(var i = 0; i < selectedprices.length; i++)
    {
      total += selectedprices[i]
    }
    console.log(total)

    p.innerHTML = "the total for this order is " + total
    modalbody.appendChild(p)

    $("#modalclose").click(function() {
      console.log("click")
      selectedprices = []
      total = 0;
      $("#total").remove();
    });



  },
  error: function(error) {
    alert("Error: " + error.code + " " + error.message);
  }
});
}








    </script>

</body>
</html>
