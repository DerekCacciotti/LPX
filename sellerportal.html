<!DOCTYPE html>
<html lang="en">
<head>
    <title>LPX- Seller Portal</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://www.parsecdn.com/js/parse-1.6.14.min.js"></script>

</head>
<body>


  <nav class=" navbar navbar-inverse">
    <div class="container-fluid">
      <!-- logo -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collaspe" data-target="#mainnavbar">
          <!-- make the three line icon found on chrome in the menu bar for settings-->
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="#" class="navbar-brand">LPX</a>
      </div>

      <!-- MENU ITEMS-->
      <div class="collaspe navbar-collaspe" id="mainnavbar">
        <ul class="nav navbar-nav">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>


<!-- right align menu item for login and sign uo buttons-->
<ul class="nav navbar-nav navbar-right">
  <li class="dropdown">
           <a href="#" class="dropdown-toggle" data-toggle="dropdown">My Profile <span class="caret"></span></a>
           <ul class="dropdown-menu">
               <li><a href="dashboard.html">Dashboard</a></li>
               <li class="active"><a href="search.html">Database</a></li>
               <li><a href="#">Log Out</a></li>
           </ul>
       </li>
   </ul>

    </ul>
      </div>
    </div>

  </nav>


  <div class="container" id="lookupbox">
      <div class="row">
          <div class="col-sm-6 col-md-4 col-md-offset-4">

              <div class="account-wall">
                    <h1 class="text-center login-title">Please enter your Order Number.</h1>
                  <form class="form-signin">
                  <input type="text" class="form-control" placeholder="Order Number" id="ordernumber" required autofocus>
                  <br />
                  <input type="button" class="btn btn-lg btn-primary btn-block"  name="loopup" value="Look Up" onclick="Lookup()">

                  </form>
              </div>

          </div>
      </div>
  </div>

  <div class="container" id="ordersection">

    <table id="order-table" class="table">

  <tr>
    <th>Item and Amount</th>
    <th>Please enter your prices in this collum</th>











  </tr>





  </table>


  <input type="text" id="emailbox" class="form-control text-center" placeholder="Enter your seller email here">

  <input type="button" class="btn btn-md btn-success pull-right" name="submittocustomer" value="Submit to customer" id="submittocustomer" onclick="Submitbacktocustomer(retrievedorder[items])"/>
  <input type="button" class="btn btn-md btn-primary pull-left" name="lookupbutton" value="Return to lookup" id="lookupbutton" onclick="returntoLookup()" />





  <div>







  <script type="text/javascript">

    Parse.initialize("bmobCoB17mgSf7S9J6ZntiQGq5NEm2eIyHroyP9t", "Wut80Nd7rKFVvHEvT7K9jQMCV2HIO67OEH0pWaBe");
      Parse.serverURL = 'https://rayfoodapp.herokuapp.com/parse'

      document.onload = onpage();

      function onpage()
      {
        $("#order-table").toggle();
        $("#submittocustomer").toggle();
        $("#lookupbutton").toggle();
        $("#emailbox").toggle();

      }

      var globordernum;

      var counter = 0
      var pricecounter = 0;

      var submittedpricesarray = []
      var retrievedorder;
      var orderforid;
      var orderfor;

      var finalprices;
      var comepletedorder = []


function Lookup()
{
  var ordernumber = document.getElementById("ordernumber").value
  console.log(ordernumber)
  globordernum = ordernumber;
  var orders = Parse.Object.extend("Order");
var query = new Parse.Query(orders);
query.get(ordernumber, {
  success: function(order) {
    console.log(order)

    orderfor = order.get("submitedbyusername")
    console.log(orderforid)


    // create table here so user can the seller can enter values

    retrievedorder = order.get("order")
    var search_term = 'undefined';

    for (var i=retrievedorder.length-1; i>=0; i--) {
        if (retrievedorder[i] === search_term) {
            retrievedorder.splice(i, 1);
             break;
        }
    }

    //console.log(retrievedorder)

    for(items in retrievedorder)
    {
      $('#order-table').append('<tr><td id="item">' + retrievedorder[items] + '</td><td>' + 	'<input type="text" name="pricebox" class="form-control text-center"> ' + '</td></tr>')
    }





    // hidden
    $("#lookupbox").toggle();

    // show
    $("#order-table").toggle();
    $("#submittocustomer").toggle();
    $("#lookupbutton").toggle();
    $("#emailbox").toggle();
















  },
  error: function(object, error) {
    // The object was not retrieved successfully.
    // error is a Parse.Error with an error code and message.
  }
});
}

function returntoLookup()
{
  // hidden
  $("#order-table").toggle();
  $("#submittocustomer").toggle();

  // showen
  $("#lookupbox").toggle();

}


function Submitbacktocustomer()
{
  var comepletedorder = []
  console.log(globordernum)
$("input[name='pricebox']").each(function() {
    comepletedorder.push($(this).val())
});


for (orders in retrievedorder)
{
  comepletedorder.unshift(retrievedorder[orders])

}


console.log(comepletedorder)

var furfilledorders = Parse.Object.extend("furfilledorders");
var furfilledordersobj = new furfilledorders();
var emailbox = document.getElementById("emailbox").value
furfilledordersobj.set("furfilledorder", comepletedorder);
furfilledordersobj.set("ordernumber", globordernum);
furfilledordersobj.set("seller", emailbox);
furfilledordersobj.set("orderfor", orderfor);
furfilledordersobj.save(null, {
  success: function(furfilledorder) {
    // Execute any logic that should take place after the object is saved.
    alert("Your order has been furfilled")
  },
  error: function(order, error) {
    // Execute any logic that should take place if the save fails.
    // error is a Parse.Error with an error code and message.
    alert('Failed to create new object, with error code: ' + error.message);
  }
});


}











































    </script>

</body>
</html>
